{{ define "main" }}
<main class="main">
  <article class="post-single">
    <header class="post-header">
      <h1 class="page-title">{{ .Title }}</h1>
    </header>

    {{ $groups := .Params.people }}
    {{ if not $groups }}
      <p>No people data found. Edit <code>content/people/_index.md</code>.</p>
    {{ else }}

      {{/* Desired display order */}}
      {{ $order := slice "PI" "PhD" "Master Student" "Bachelor Student" "Alumni" }}

      {{ range $order }}
        {{ $gname := . }}
        {{ $g := first 1 (where $groups "group" $gname) }}
        {{ if gt (len $g) 0 }}
          {{ $group := index $g 0 }}
          {{ $items := $group.items }}
          {{ if and $items (gt (len $items) 0) }}

            <h2 class="sec-title">{{ $gname }}</h2>

            {{/* Sort by weight safely */}}
            {{ $rows := slice }}
            {{ range $items }}
              {{ $w := 999999 }}
              {{ if isset . "weight" }}{{ $w = int (printf "%v" .weight) }}{{ end }}
              {{ $rows = $rows | append (dict "p" . "w" $w) }}
            {{ end }}
            {{ $rows = sort $rows "w" "asc" }}

            <div class="people-grid">
              {{ range $rows }}
                {{ $p := .p }}

                {{ $photo := "" }}
                {{ with (index $p "photo") }}{{ $photo = . }}{{ end }}

                {{/* Only show photo for PI and PhD, and only if photo is non-empty */}}
                {{ $showPhoto := and (or (eq $gname "PI") (eq $gname "PhD")) (ne $photo "") }}

                <div class="person-card {{ if $showPhoto }}has-photo{{ else }}no-photo{{ end }} {{ if or (eq $gname "PI") (eq $gname "PhD") }}pi-wide{{ end }}">

                  {{ if $showPhoto }}
                    <div class="person-photo">
                      <img src="{{ $photo | relURL }}" alt="{{ index $p "name" }}" loading="lazy" />
                    </div>
                  {{ end }}

                  <div class="person-meta">
                    <div class="person-name">{{ index $p "name" }}</div>

                    {{ with (index $p "role") }}
                      {{ if ne . "" }}<div class="person-role">{{ . }}</div>{{ end }}
                    {{ end }}

                    {{ with (index $p "affiliation") }}
                      {{ if ne . "" }}<div class="person-affil">{{ . | markdownify }}</div>{{ end }}
                    {{ end }}

                    {{ with (index $p "email") }}
                      {{ if ne . "" }}
                        <div class="person-email"><a href="mailto:{{ . }}">{{ . }}</a></div>
                      {{ end }}
                    {{ end }}

                    {{/* NEW: Links row (only if provided) */}}
                    {{ with (index $p "links") }}
                      {{ if gt (len .) 0 }}
                        <div class="person-links">
                          {{ range . }}
                            {{ $lab := index . "label" }}
                            {{ $url := index . "url" }}
                            {{ if and $lab $url }}
                              <a class="person-link" href="{{ $url }}" target="_blank" rel="noopener">{{ $lab }}</a>
                            {{ end }}
                          {{ end }}
                        </div>
                      {{ end }}
                    {{ end }}

                    {{/* Interests: regular paragraph, comma-separated (no boxes) */}}
                    {{ with (index $p "interests") }}
                      {{ $t := printf "%T" . }}
                      {{ if in $t "[]" }}
                        {{ if gt (len .) 0 }}
                          <div class="person-interests">{{ delimit . ", " }}</div>
                        {{ end }}
                      {{ else }}
                        {{ if ne (printf "%v" .) "" }}
                          <div class="person-interests">{{ printf "%v" . }}</div>
                        {{ end }}
                      {{ end }}
                    {{ end }}

                  </div>

                </div>
              {{ end }}
            </div>

          {{ end }}
        {{ end }}
      {{ end }}

    {{ end }}
  </article>
</main>

<style>
.page-title{
  margin:.2rem 0 1.1rem 0;
  font-size:clamp(1.9rem,2.2vw,2.4rem);
  font-weight:700;
  color:#fff;
}

.sec-title{
  margin:1.4rem 0 .7rem 0;
  padding-top:.6rem;
  border-top:1px solid rgba(255,255,255,.14);
  font-weight:750;
  font-size:1.1rem;
  color:#fff;
}

.people-grid{
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:1rem;
}

/* Base card */
.person-card{
  padding:1rem;
  border:1px solid rgba(255,255,255,.14);
  border-radius:14px;
  background:rgba(0,0,0,.18);
  color:#fff;
}

/* Only PI/PhD cards with photos use the 2-column layout */
.person-card.has-photo{
  display:grid;
  grid-template-columns:110px 1fr;
  gap:.95rem;
  align-items:start;
}

/* Make PI/PhD cards span full width (wider, nicer) */
.person-card.pi-wide{
  grid-column: 1 / -1;
}

/* Optional: give PI/PhD a bit more breathing room */
.person-card.pi-wide.has-photo{
  grid-template-columns: 140px 1fr;
  gap: 1.1rem;
}

/* Optional: slightly larger PI/PhD photo */
.person-card.pi-wide .person-photo img{
  width: 140px;
  height: 140px;
  border-radius: 14px;
}

/* Everyone else: no photo block, simple single-column */
.person-card.no-photo{
  display:block;
}

.person-photo img{
  width:110px;
  height:110px;
  border-radius:14px;
  object-fit:cover;
  display:block;
  box-shadow:0 0 0 1px rgba(255,255,255,.10);
}

.person-name{
  font-weight:800;
  font-size:1.08rem;
  margin:0 0 .25rem 0;
  line-height:1.25;
}
.person-role{
  opacity:.92;
  font-size:.95rem;
  margin-bottom:.2rem;
}
.person-affil{
  opacity:.88;
  font-size:.92rem;
  line-height:1.45;
  margin-bottom:.35rem;
  white-space:pre-line;
}
.person-email{
  font-size:.92rem;
  margin-bottom:.35rem;
}
.person-email a{ color:#fff; text-decoration:none; }
.person-email a:hover{ text-decoration:underline; }

/* NEW: Links row */
.person-links{
  display:flex;
  flex-wrap:wrap;
  gap:.55rem .75rem;
  margin:.05rem 0 .35rem 0;
  font-size:.92rem;
  opacity:.95;
}
.person-link{
  color:#fff;
  text-decoration:none;
  border-bottom:1px solid rgba(255,255,255,.22);
  padding-bottom:1px;
}
.person-link:hover{
  border-bottom-color: rgba(255,255,255,.55);
}

/* Interests as normal paragraph (no tags/boxes) */
.person-interests{
  margin-top:.35rem;
  opacity:.92;
  font-size:.92rem;
  line-height:1.55;
}

@media (max-width:760px){
  .people-grid{ grid-template-columns:1fr; }

  .person-card.has-photo{ grid-template-columns:96px 1fr; }
  .person-photo img{ width:96px; height:96px; border-radius:12px; }
}
</style>
{{ end }}
